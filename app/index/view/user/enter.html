<html lang="zh-CN">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
        <title>{$title}</title>

        {css href="/static/css/normalize.css" /}
		{css href="/static/bootstrap/bootstrap.min.css" /}

		{js href="/static/bootstrap/jquery-3.2.1.min.js" /}
		{js href="/static/bootstrap/bootstrap.min.js" /} 
		{js href="/static/bootstrap/bootstrap-treeview.min.js" /}

		{css href='/static/toastr/toastr.css' /}
		{js href="/static/toastr/toastr.js" /}

		<style>
			body {
				background-color: #eee;
			}
			.login-box {
				padding: 20px;
				background-color: #fafafa;
				width: 400px;
			    height: 350px;
			    margin: auto;
			    position: relative;
			    top: 20%;
			    border-radius: 5px;
			}
			.login-box > form {
				padding: 10px;
			}
		</style>
	</head>

    <body>
		<div class="login-box">
			<ul class="nav nav-tabs">
			  	<li role="presentation" class="active"><a>登录</a></li>
			  	<li role="presentation"><a>注册</a></li>
			</ul>
			<form onsubmit="return false;" id='signin'>
			  	<div class="form-group">
			    	<label for="account">帐号</label>
			    	<input type="text" name='account' class="form-control" id="account" placeholder="Account">
			  	</div>
			  	<div class="form-group">
				    <label for="password">密码</label>
				    <input type="password" name='password' class="form-control" id="password" placeholder="Password">
				</div>
			  	<div class="checkbox">
			    	<label><input type="checkbox" name='isChecked'> 记住密码</label>
			  	</div>
			  	<button type="submit" class="btn btn-default" data-type='signin'>登录</button>
			</form>
			<form style="display: none;" onsubmit="return false;" id='signup'>
			  	<div class="form-group">
			    	<label for="account">帐号</label>
			    	<input type="text" name='account' class="form-control" id="account" placeholder="Account">
			  	</div>
			  	<div class="form-group">
				    <label for="password">密码</label>
				    <input type="password" name='password' class="form-control" id="password" placeholder="Password">
				</div>
				<div class="form-group">
				    <label for="rePassword">确认密码</label>
				    <input type="password" name='rePassword' class="form-control" id="rePassword" placeholder="rePassword">
				</div>
			  	<button type="submit" class="btn btn-default" data-type='signup'>注册</button>
			</form>
		</div>
    </body>

    <script>
    	$('.nav-tabs > li').on('click', function (v, k) {
    		var index = $(this).index()
    		$('.nav-tabs > li').removeClass('active').eq(index).addClass('active')
    		$('.login-box form').css('display', 'none').eq(index).css('display', 'block')
    	})

    	$('.btn.btn-default').click(function (event) {
    		var type = $(this).data('type')
    		var form = $('#' + type).serialize()

    		var params = {}
			form.split('&').forEach(function (v, k) {
				var sArr = v.split('=')
				if (sArr.length === 2) {
					params[sArr[0]] = sArr[1]
				} else {
					sArr.splice(0, 1)
					params[sArr[0]] = sArr.join('=')
				}
			})

			var hasChinese = false
			var flag = Object.keys(params).every( function(v, k) {
				var val = $.trim(params[v])
				if (val.length === 0 && v === 'account') {
					toastr.warning('帐号不能为空')
				}
				if (val.length === 0 && v === 'password') {
					toastr.warning('密码不能为空')
				}
				if(escape(decodeURI(val)).indexOf("%u") !== -1) {
					hasChinese = true
					toastr.warning('不能包含中文字符')
				}
				return val.length > 0
			});
			if (!flag || hasChinese) return

			if (params.hasOwnProperty('rePassword')) {
				if ($.trim(params['rePassword']).length <= 0) {
					toastr.warning('请填写确认密码')
					return	
				}
				if ($.trim(params['rePassword']) !== $.trim(params['password'])) {
					toastr.warning('两次密码不相同')
					return
				}
			}

    		$.ajax({
    			type: "POST",
    			url: '/index/user/' + type,
    			data: $('#' + type).serialize(),
    			success: function (res) {
    				// console.log(res)
    				if (res.code === 1) {
    					location.href = res.url
    				} else if (res.code === 0) {
    					toastr.warning(res.msg)
    				}
    			},
    			error: function (err) {
    				console.log(err)
    			}
    		})
    	})
    </script>
</html>